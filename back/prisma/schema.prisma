// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                   Int                  @id @default(autoincrement())
  login                String               @unique
  passwordHash         String
  salt                 String?
  isPasswordKeptAsHash Boolean?
  passwords            WalletRecord[]
  logins               LoginRecord[]
  sharedWalletRecords  SharedWalletRecord[]
}

model LoginRecord {
  id                 Int       @id @default(autoincrement())
  loginTime          DateTime
  wasLoginSuccessful Boolean
  attempt            Int
  ipAddress          IPRecord? @relation(fields: [ipId], references: [id])
  ipId               Int?
  user               User?     @relation(fields: [userId], references: [id])
  userId             Int?
}

model IPRecord {
  id                   Int           @id @default(autoincrement())
  ipAddress            String        @unique
  blockedUntil         DateTime?
  isBlockedPermanently Boolean?
  logins               LoginRecord[]
}

model WalletRecord {
  id          Int     @id @default(autoincrement())
  password    String
  webAddress  String?
  description String?
  login       String?

  user   User? @relation(fields: [userId], references: [id])
  userId Int?

  sharedWalletRecords SharedWalletRecord[]
}

model SharedWalletRecord {
  id             Int          @id @default(autoincrement())
  walletRecordId Int
  wallletRecord  WalletRecord @relation(fields: [walletRecordId], references: [id])

  userId Int
  user   User @relation(fields: [userId], references: [id])
}
